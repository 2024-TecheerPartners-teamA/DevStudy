## Docker란 무엇인가?

'도커(docker)는 리눅스의 응용프로그램들을 소프트웨어 컨테이너(Container) 안에 배치시키는 일을 자동화하는 오픈소스 프로젝트이다.'
정의는 이렇다. 그렇다면 여기서 이야기하는 컨테이너(Container)란 무엇일까?

### 컨테이너란?

컨테이너라고 하면 가장 먼저 떠오르는 것은 바로 선박컨테이너이다. 선박 컨테이너와 같이 소프트웨어 컨테이너도 다양한 프로그램, 실행환경 등을 컨테이너로 추상화할 수 있을 뿐만 아니라 프로그램의 배포 관리를 단순하게 해주는 기능을 하고있다.
즉 '패키징'과 '운반'을 편리하게 해준다는 점이 바로 공통점이다.

### 가상화(virtualization)와 리눅스(Linux) 컨테이너
![다운로드 (1)](https://github.com/user-attachments/assets/d694f642-cd8c-4607-bd04-67382e036852)

컨테이너를 이해하기위해서는 일단 가상화라는 개념을 알고있어야한다. 가상화는 컴퓨터 리소스의 추상화를 일컫는 말이다. 쉽게말하면 애플리케이션, 서버, 저장장치 등 물리적으로 하나인 것을 복수의 것처럼 또는 반대로 복수인 것을 하나인 것처럼 만들어주는 기술이다.

가상화를 통해서 가상머신 (vm)을 만들어낼 수 있다. vm은 호스트 운영체제에서 구동되며 그 바탕이 되는 하드웨어에 가상으로 액세스하는 Guest 운영체제를 가지는 일종의 격리된머신이다.
쉽게말하면 하나의 컴퓨터이다. (물리적인 컴퓨터 자원을 가상화시켜 별도의 컴퓨터를 만들고 거기에 운영체제를 올렸다고생각)

컨테이너는 가상머신과 마찬가지로 애플리케이션을 관련 라이브러리 및 모든 종속항목과 패키지 (그냥 app에 필요한 모든 파일들)로 묶어 소프트웨어 서비스 구동을 위한 격리환경을 마련해주지만 큰 차이점이 있다.

바로 가상화 방식이 다르다는 점이다. 기조의 vm을 생성하는 가상화 방식은 주로 os를 가상화하였다. Host OS가 존재하고 그 위에 Guest OS전체를 가상화하는 방식이었다. 그러므로 os가 가상머신 이미지에 포함되어야만하고 이는 용량이 매우 클 수 밖에 없는 구조다.

![다운로드 (2)](https://github.com/user-attachments/assets/51e8aca2-6946-40c7-ace3-4feb49e960be)
하지만 컨테이너 기술은 별도의 하드웨어 에뮬레이션( 특정 환경이나 시스템을 가상으로 재현하는 기술) 없이 리눅스 커널을 공유하여 컨테이너를 실행하며 Guest os가 존재하지 않는다. 이런 가상화를 '운영체제 수준의 가상화'라고 부른다. 
이게 가능한 까닭은 바로 리눅스 컨테이너를 통해 '프로세스를 격리'하는 것이 가능하기 때문이다.

### 프로세스격리?
리눅스(Linux) 운영체제는 커널 공간과 사용자 공간이 존재한다. 이 중 사용자 공간을 여러 개로 나누어 프로세스에서 사용하는 리소스를 제한할 수 있다. 이것이 바로 컨테이너의 근간이 되는 기술이다. 즉 각각의 프로세스가 독립된 공간에서 할당받은 자원을 이용하여 동작하도록 만들 수 있는 것이다. 이게 가능한 이유는 다음과 같은 기술을 리눅스(Linux)에서 제공하기 때문이다.

리눅스 네임스페이스(namespace)

![리눅스 네임스페이스](https://github.com/user-attachments/assets/06a88e5a-f612-40a0-b6b0-e34ed9cad786)
리눅스 네임스페이스는 각 프로세스가 파일시스템, 네트워크, 유저, 호스트네임 등에 대해서 시스템이 독립뷰를 가질 수 있도록 만들어준다.

리눅스 컨트롤 그룹(cgroups)

![리눅스 컨트롤 그룹](https://github.com/user-attachments/assets/6fd898c0-675b-409b-a780-060a628199b9)

리눅스 컨트롤 그룹은 프로세스가 소비할 수 있는 리소스(CPU, 메모리, I/O, 네트워크 대역)등을 제한할 수 있는 기능으로 각각의 프로세스에 리소스를 할당할 수 있다.
기존 가상화 기술에서는 VM이 실제 물리 하드웨어를 에뮬레이트 하므로, OS가 반드시 필요하다. 하지만 리눅스 컨테이너(LXC)에서는 모든 프로세스가 호스트 OS에서 바로 시작한다. 일반적인 프로세스와 다른 점은 그룹화를 통해 단절된 공간에서 동작한다는 것이다. 리눅스 컨테이너 기술은 도커 컨테이너가 사용하는 기술의 근간이 되는 기술이다.

즉, 컨테이너라는 것은 리눅스가 제공하는 기능을 이용하여 단절된 공간에서 할당받은 시스템 자원을 통해 독립적으로 가동되는 일종의 '프로세스' 이다.

## 도커가 그래서 뭔가요
많은 사람들이 '도커 = 컨테이너(Container)' 라고 생각하지만 위에서 살펴보았듯이 컨테이너 기술은 도커가 탄생하기 한참 전부터 존재헀다.

도커는 컨테이너 기술을 지원하는 다양한 프로젝트 중 하나일 뿐이다. 그렇다면 도커만이 가지는 장점은 무엇이기에 이렇게 유명해진걸까?

 ![도커란](https://github.com/user-attachments/assets/9b08405f-daff-46f0-b119-3167bd6e76bb)

도커는 오버레이 네트워크(Overlay Network), 유니온 파일 시스템(Union File System)등 이미 존재하고 있는 기술들을 정교하게 잘 조합하여 사용자 입장에서 정말 사용하기 편리하게 만들어 놓았다. 그리하여 도커는 컨테이너 기술 분야의 사실상 업계 표준이 될 수 있었다.

### 도커이미지

<img width="629" alt="도커이미지" src="https://github.com/user-attachments/assets/231d9ea7-d3fa-4874-a3e4-5a91616f4d4a">
컨테이너라는 개념과 더불어 도커에서 가장 중요한 개념이 바로 '이미지(Image)' 이다. 이미지는 우리가 흔히 생각하는 사진이라고 생각하면 안된다. 도커에서 이미지는 컨테이너 실행에 필요한 모든 파일과 설정 값 등을 포함한 것으로 상태값을 가지지 않고 변하지 않는 것이다.
즉 컨테이너는 '이미지를 실행한 상태'라고 봐도 무방하다.

새로운 서버가 추가되면 이것저것 설치할 필요없이 미리 만들어진 이미지를 다운로드 받고 컨테이너만 생성하면 되므로 서버증설이 매우 용이하다.


### 저장방식-레이어(Layer) 저장방식

실행에 관련된 모든 파일을 포함하고 있다면 용량이 매우 클 것 같은데, 만약 기존 이미지에 파일을 하나 더 추가한다면 다시 그 큰 용량을 다운로드 받아야하나? 그렇다면 굉장히 비효율적이지않을까? 라는 의문이 들 수도 있다.
굉장히 비효율적인게 맞지만, 그래서 도커는 아주 영리한 저장방식을 사용한다. 바로 'Layer 저장방식'이다. 레이어 저장 방식은 유니온 파일 시스템(Union File System)을 이용하여 여러개의 Layer를 하나의 파일시스템으로 만드는 방식을 의미한다.

![레이어 저장방식](https://github.com/user-attachments/assets/b1a023a2-2240-4961-a4f2-c479d2eb474f)

그림에서 살펴볼 수 있듯이 이미지 하나는 여러개의 immutable layer로 구성된다. Immuatble은 불변이라는 듯으로 절대로 변하지 않는다.
우분투의 이미지가 abc레이어로 이루어져있고 이미 우분투 이미지를 저장해서 가지고있다고가정하면, 우분투 이미지가 이미 있는 상태에서 우분투 기반의 nginx이미지를 도커허브에서 가져온다면 어떻게 될까?

a+b+c+nginx 레이어로 이루어진 이미지를 통채로 가져올까? 아니다. 이 경우에는 이미 존재하는 a+b+c 레이어는 다운로드 받지 않고 새로 필요한 nginx 레이어만 다운로드 받아서 새로운 이미지를 구성한다.

또한 이미지를 기반으로 컨테이너를 생성하게 되면 자동으로 R/W레이어가 추가되어 생성된다. 이미지 레이어(Immutable)를 그대로 사용하면서, 컨테이너 실행 중 생성하는 파일이나 변경사항은 모두 R/W레이어에 기록 된다. 기존의 이미지 레이어는 절대로 변하거나 영향을 받지 않는다. 그래서 'Immutable', '상태값을 가지지 않고 변하지 않음' 이라는 표현을 사용하는 것이다.
